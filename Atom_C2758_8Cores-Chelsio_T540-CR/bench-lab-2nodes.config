#!/bin/sh
# Configuration example for forwarding/routing performance with netmap pkt-gen:
#
#            ------admin network: 192.168.1.0/24 (ssh)----------
#              | .8                                         | .10
#+-------------------------------------+      +-----------------------------------+
#|        Device under test            |      |   Packet generator and receiver   |
#|                                     |      |                                   |
#| cxl0: 198.18.0.8 (00:07:43:2e:e5:90)|<=====| ncxl0 (00:07:43:2e:e4:71)         |
#|                                     |      | cxl0: 198.18.0.110 (online check) |
#| cxl1: 198.19.0.8 (00:07:43:2e:e5:98)|=====>| ncxl1 (00:07:43:2e:e4:79)         |
#|                                     |      | cxl1: 198.19.0.110 (online check) |
#|                                     |      |                                   |
#|          static routes              |      | ifconfig ncxl0 txcsum             |
#|    192.18.0.0/16 => 198.18.0.10     |      | ifconfig ncxl0 up                 |
#|    192.19.0.0/16 => 198.19.0.10     |      | ifconfig ncxl1 up                 |
#|          static arp                 |      |                                   |
#|   198.18.0.10 => 00:07:43:2e:e4:71  |      |                                   |
#|   198.19.0.10 => 00:07:43:2e:e4:79  |      |                                   |
#+-------------------------------------+      +-----------------------------------+
# Admin network IP
SENDER_ADMIN="192.168.1.10"
RECEIVER_ADMIN="192.168.1.10"
DUT_ADMIN="192.168.1.8"

# LAB network IP and data
SENDER_LAB_IP="198.18.0.110"
RECEIVER_LAB_IP="198.19.0.110"

#netmap pkt-gen need these information:
SENDER_LAB_IF="ncxl0"
SENDER_LAB_IF_MAC="00:07:43:2e:e4:71"
RECEIVER_LAB_IF="ncxl1"
RECEIVER_LAB_IF_MAC="00:07:43:2e:e4:79"
DUT_LAB_IF_MAC_SENDER_SIDE="00:07:43:2e:e5:90"
DUT_LAB_IF_MAC_RECEIVER_SIDE="00:07:43:2e:e5:98"
#Generate about 2000 flows (20*100)
# source/dest IP and port can be modified
# Used for testing different value of flows as examples
: ${SENDER_LAB_NET:="198.18.1.1:2000-198.18.1.20"}
: ${RECEIVER_LAB_NET="198.19.1.1:2000-198.19.1.100"}
PKT_TO_SEND="1000000000"

#Timeout: Number of seconds / 5 to wait before declaring a problem for DUT rebooting process
REBOOT_TIMEOUT=120

#Is DUT online: Test command
IS_DUT_ONLINE_TARGET=${DUT_ADMIN}
IS_DUT_ONLINE_CMD="ping -c 2 ${RECEIVER_LAB_IP}"

#Bench commands
RECEIVER_START_CMD="pkt-gen -f rx -i ${RECEIVER_LAB_IF} -w 4"
RECEIVER_STOP_CMD="pkill pkt-gen"
SENDER_START_CMD="pkt-gen -f tx -i ${SENDER_LAB_IF} -n ${PKT_TO_SEND} -l 60 \
        -d ${RECEIVER_LAB_NET} -D ${DUT_LAB_IF_MAC_SENDER_SIDE} -s ${SENDER_LAB_NET} \
        -S ${SENDER_LAB_IF_MAC} -w 4"
